<!DOCTYPE html>

<html lang="pt-BR">

<head>
	<meta charset="utf-8" />
	<title>mobLee GraphQL Challenge</title>
  <meta name="description" content="mobLee GrapthQL Challenge" />
  <meta name="author" content="Luciano Nunes" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="css/defaults.css?v=1.0" />
  <link rel="stylesheet" href="css/styles.css?v=1.0" />

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
	<header id="main-header">
		<h1>StackOverflow</h1>
	</header>
	
	<main>
		<h2 class="form-title">Buscar na API</h2>	

		<form class="form-search" onsubmit="return validateForm(this)" action="javascript:query()" >
			<div class="form-group">
				<label>Tag</label>
				<input type="text" name="tag" placeholder="Try Javascript" />
			</div>
			<div class="form-group">
				<label>Limit</label>
				<input type="number" name="limit" />
			</div>
			<div class="form-group">
				<label>Score</label>
				<input type="number" name="score" />
			</div>
			<div class="form-group">
				<label>Sort</label>
				<input type="text" name="sort" />
			</div>
			<div class="form-action">
				<input class="form-button" type="submit" name="search" value="Buscar" />
			</div>
		</form>
	</main>

	<footer id="main-footer">
		<p>Copyright &copy 2018, Luciano Nunes</p>
	</footer>
	
	<script src="js/scripts.js"></script>
	<script>
		function queryIndex() {

			console.log("Query Index");	

			var form = document.getElementsByClassName("form-search")[0];

			var tag = form["tag"].value;
			if (tag == "") {
				tag = "javascript";
			}
			//tag += ', Javascript';

			var limit = form["limit"].value;
			if (limit == "") {
				limit = 2;
			}

			var score = form["score"].value;
			if (score == "") {
				score = 0;
			}

			var sort = form["sort"].value;
			if (sort == "") {
				sort = "votes";
			}

			var xhr = new XMLHttpRequest();
				xhr.responseType = 'json';
				xhr.open("POST", "http://localhost:4000/graphql");
				xhr.setRequestHeader("Content-Type", "application/json");
				xhr.setRequestHeader("Accept", "application/json");
				xhr.onload = function () {
						console.log('data returned:', xhr.response);
			}
			xhr.onreadystatechange = function() { 
				if (xhr.readyState == xhr.DONE && xhr.status == 200)
					console.log("onreadystatechange - state: " + this.readyState + ", status: " + this.status + ", response: " + this.response);
				else
					console.log("onreadystatechange - state: " + this.readyState + ", status: " + this.status + ", response: " + this.response);
			};
			xhr.onerror = function() {
				console.log("onerror - state: " + this.readyState + ", status: " + this.status + ", response: " + this.response);
			};
						
			var query = 
			`{ questions(tag: "${tag}", limit: ${limit}, score: ${score}, sort: "${sort}") {
								questionId,
								title,
								link,
								score
						}
				}`;

				xhr.send(JSON.stringify({query: query}));
			}
	</script>
</body>

</html>
